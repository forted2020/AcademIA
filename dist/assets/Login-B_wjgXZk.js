import{r as d,_,R,a as $,c as A,P as y,o as D,j as e,L as N}from"./index-CQcJGhZo.js";import{C as b}from"./index.esm-miwwEqOb.js";import{l as G}from"./api-KE1A3WEm.js";import{C as L}from"./CContainer-pv1BoYo7.js";import{C as S,a as x}from"./CRow-CCKjXgEG.js";import{C as w,a as I}from"./CCardBody-Da11kLgp.js";import{C as U}from"./CForm-CW-aKSWy.js";import{C as h,a as f,b as P}from"./CInputGroupText-DF-LoAY-.js";import{c as B}from"./cil-user-Ddrdy7PS.js";import{c as F}from"./cil-lock-locked-DmxpJbVL.js";import{C as q}from"./CFormSelect-b0EkHFBR.js";import{a as j}from"./CButton-rOzXJk2W.js";import"./index-t--hEgTQ.js";var v=d.forwardRef(function(r,m){var a=r.children,u=r.className,c=_(r,["children","className"]);return R.createElement("div",$({className:A("card-group",u)},c,{ref:m}),a)});v.propTypes={children:y.node,className:y.string};v.displayName="CCardGroup";const se=()=>{const[r,m]=d.useState(""),[a,u]=d.useState(""),[c,T]=d.useState("EST"),[C,o]=d.useState(""),E=D(),p=t=>{const{name:i,value:n}=t.target;console.log(`Input cambiado: ${i}=${n}`),i==="username"?m(n):i==="password"?u(n):i==="tipo_usuario"&&T(n),o("")},k=async t=>{var n;if(t.preventDefault(),localStorage.removeItem("token"),localStorage.removeItem("user"),console.log("Formulario enviado:",{username:r,password:a,tipo_usuario:c}),console.log("username.trim():",r.trim(),"password.trim():",a.trim()),!r.trim()||!a.trim()){o("Por favor, ingrese usuario y contraseña."),console.log("Error establecido: Por favor, ingrese usuario y contraseña.");return}const i={name:r,password:a,tipo_usuario:c};console.log("Cuerpo de la solicitud a /api/login:",JSON.stringify(i));try{console.log("Enviando solicitud a /api/login...");const s=await G(i),{access_token:l,tipos_usuario:g}=s.data;if(localStorage.setItem("token",l),localStorage.setItem("user",JSON.stringify({tipos_usuario:g})),console.log("Token guardado:",localStorage.getItem("token")),console.log("Login exitoso. Redirigiendo..."),g.includes("ADM"))E("/usuarios");else if(g.includes("EST"))E("/estudiante");else{o("Tipo de usuario no reconocido.");return}}catch(s){if(console.error("Error completo:",s),console.error("Respuesta del servidor:",s.response),s.response){console.log("Datos de la respuesta:",s.response.data);const l=((n=s.response.data)==null?void 0:n.detail)||"Error desconocido";s.response.status===401?(o("Credenciales inválidas. Por favor, intente nuevamente."),console.log("Error establecido: Credenciales inválidas.")):s.response.status===403?(o(`Acceso denegado: ${l}`),console.log(`Error establecido: Acceso denegado: ${l}`)):s.response.status===404?(o("Endpoint no encontrado. Verifique la configuración del servidor."),console.log("Error establecido: Endpoint no encontrado.")):(o(`Error del servidor: ${s.response.status} - ${l}`),console.log(`Error establecido: Error del servidor: ${s.response.status} - ${l}`))}else s.request?(o("Error de red. Por favor, verifique su conexión e intente nuevamente."),console.log("Error establecido: Error de red.")):(o("Error al iniciar sesión. Por favor, intente nuevamente."),console.log("Error establecido: Error al iniciar sesión."))}};return e.jsx("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-row align-items-center",children:e.jsx(L,{children:e.jsx(S,{className:"justify-content-center",children:e.jsx(x,{md:8,children:e.jsxs(v,{children:[e.jsx(w,{className:"p-4",children:e.jsx(I,{children:e.jsxs(U,{onSubmit:k,children:[" ",e.jsx("h1",{children:"Iniciar sesión"}),e.jsx("p",{className:"text-body-secondary",children:"Inicia sesión en tu cuenta"}),e.jsxs(h,{className:"mb-3",children:[e.jsx(f,{children:e.jsx(b,{icon:B})}),e.jsx(P,{type:"text",name:"username",placeholder:"Usuario (Email o Nombre)",value:r,onChange:p,autoComplete:"username"})]}),e.jsxs(h,{className:"mb-4",children:[e.jsx(f,{children:e.jsx(b,{icon:F})}),e.jsx(P,{type:"password",name:"password",placeholder:"Contraseña",value:a,onChange:t=>{console.log("Password input cambiado:",t.target.value),p(t)},autoComplete:"current-password"})]}),e.jsxs(h,{className:"mb-3",children:[e.jsx(f,{children:"Tipo de usuario"}),e.jsxs(q,{name:"tipo_usuario",value:c,onChange:p,children:[e.jsx("option",{value:"EST",children:"Estudiante"}),e.jsx("option",{value:"ADM",children:"Administrador"})]})]}),C?e.jsx("div",{style:{color:"red",marginBottom:"1rem",fontWeight:"bold",minHeight:"1.5rem"},"data-testid":"error-message",children:C}):e.jsx("div",{style:{minHeight:"1.5rem"}}),e.jsxs(S,{children:[e.jsx(x,{xs:6,children:e.jsx(j,{color:"primary",type:"submit",className:"px-4",children:"Iniciar sesión"})}),e.jsx(x,{xs:6,className:"text-right",children:e.jsx(N,{to:"/forgot-password",children:e.jsx(j,{color:"link",className:"px-0",children:"Olvidó su contraseña?"})})})]})]})})}),e.jsx(w,{className:"text-white bg-primary py-5",style:{width:"44%"},children:e.jsx(I,{className:"text-center",children:e.jsxs("div",{children:[e.jsx("h2",{children:"Sistema de Gestión Académica"}),e.jsx("p",{children:"Bienvenido al Sistema de Gestión Académica. Por favor, inicie sesión para acceder a su cuenta."}),e.jsx(N,{to:"/register",children:e.jsx(j,{color:"primary",className:"mt-3",active:!0,tabIndex:-1,children:"Registrarse"})})]})})})]})})})})})};export{se as default};
